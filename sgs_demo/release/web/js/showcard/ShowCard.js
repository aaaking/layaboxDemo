var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),ShowCard=function(t){function i(){var i=t.call(this)||this;return i._mask.width=Laya.stage.width,i._mask.height=Laya.stage.height,i._mask.on(Laya.Event.CLICK,i,i.onTouch),i._btnOpen.on(Laya.Event.CLICK,i,i.onTouch),i._btnBack.on(Laya.Event.CLICK,i,i.onTouch),Laya.stage.on(Laya.Event.RESIZE,i,i.onResize),i}return __extends(i,t),Object.defineProperty(i,"instance",{get:function(){return this._instance||(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.prototype.show=function(t){t&&!i.instance.parent&&t.addChild(i.instance),this.mouseEnabled=!0,Laya.Tween.clearAll(this._boxWaiting),Laya.Tween.clearAll(this._labTip),Laya.timer.clearAll(this),this._btnOpen.visible=this._imgBg.visible=!0,this._imgIcon.visible=this._labTip.visible=this._boxWaiting.visible=!1,this.off(Laya.Event.CLICK,this,this.onTouch),this.onResize(null)},i.prototype.toAscii=function(t){var i="",e=0,n=t.length;for("0x"===t.substring(0,2)&&(e=2);e<n;e+=2){var a=parseInt(t.substr(e,2),16);i+=String.fromCharCode(a)}return i},i.prototype.onTouch=function(t){switch(t.currentTarget){case this._btnBack:this.removeSelf(),t.stopPropagation();break;case this._btnOpen:this.mouseEnabled=!1,this._boxWaiting.visible=!0,this._boxWaiting.alpha=0,Laya.Tween.to(this._boxWaiting,{alpha:1},500,null),Laya.timer.loop(5e3,this,function(){}),t.stopPropagation(),Ajax.callNet(GameConfig.RPC_URL,{jsonrpc:"2.0",method:"personal_unlockAccount",params:[localStorage.getItem("uuid"),"",null],id:67},"POST",null,function(t){console.info(t),JSON.parse(t).result&&Ajax.callNet(GameConfig.RPC_URL,{jsonrpc:"2.0",method:"eth_sendTransaction",params:[{from:localStorage.getItem("uuid"),to:GameConfig.RPC_ADDRESS,data:"0x62158099",value:"0x20"}],id:67},"POST",null,function(t){console.info(t);var i=JSON.parse(t);i.error?(this._wait.text="交易失败",Laya.timer.once(2e3,this,function(){this.mouseEnabled=!0,this._boxWaiting.visible=!1})):(this._wait.text="正在开卡中请等待...",Laya.timer.loop(1e4,this,function(){Ajax.callNet(GameConfig.RPC_URL,{jsonrpc:"2.0",method:"eth_getTransactionReceipt",params:[i.result],id:67},"POST",null,function(t){console.info(t);JSON.parse(t).result&&(Laya.timer.clearAll(this),this.mouseEnabled=!0,this._boxWaiting.visible=!1,Ajax.callNet(GameConfig.RPC_URL,{jsonrpc:"2.0",method:"eth_call",params:[{from:localStorage.getItem("uuid"),to:GameConfig.RPC_ADDRESS,data:"0x179a074f"},"latest"],id:67},"POST",null,function(t){console.info(t);var i=JSON.parse(t).result.substring(130);i="0x"+i;var e=this.toAscii(i).split(",");e.pop();for(var n in e){var a=e[n].split(":"),o=parseInt(a[0]),s=(GameConfig.getCfgHeroById(o),a[1]);if(parseInt(s)>0&&CardPackageManager.instance.getCountByID(o)>=0&&parseInt(s)-CardPackageManager.instance.getCountByID(o)==1){this.showCard(o),CardPackageManager.instance.addCountByID(o);break}}}.bind(this)))}.bind(this))}))}.bind(this))}.bind(this));break;case this:Laya.Tween.clearAll(this._labTip),this.off(Laya.Event.CLICK,this,this.onTouch),this._btnOpen.visible=this._imgBg.visible=!0,this._imgIcon.visible=this._labTip.visible=!1}},i.prototype.onResize=function(t){void 0===t&&(t=null),this.width=Laya.stage.width,this.height=Laya.stage.height},i.prototype.testOpenCard=function(){return Math.floor(25*Math.random())+0},i.prototype.showCard=function(t){var i=this,e=GameConfig.getCfgHeroById(t);this._imgIcon.skin="showcards/"+e.icon+".png",this._btnOpen.visible=this._imgBg.visible=!1,this._imgIcon.visible=!0,Laya.timer.once(1e3,this,function(){i._labTip.visible=!0,i.on(Laya.Event.CLICK,i,i.onTouch)})},i}(ui.showcard.ShowCardUI);