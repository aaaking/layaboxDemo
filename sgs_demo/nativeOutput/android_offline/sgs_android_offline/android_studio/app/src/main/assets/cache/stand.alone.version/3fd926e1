var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var menu;
(function (menu) {
    var SceneMenu = /** @class */ (function (_super) {
        __extends(SceneMenu, _super);
        function SceneMenu() {
            var _this = _super.call(this) || this;
            _this.circleToBottom = 88;
            _this.circleToRight = 98;
            _this._preWidth = UITools.canvasWidth;
            _this._yPos = 335; //卡片中心距离顶部的距离
            _this._circleDis = 435; //相邻卡片的中心距离
            Laya.stage.addChild(_this);
            _this.initAvator();
            _this.initBalance();
            _this.initOpenCard();
            _this.initExchangeCard();
            _this.initMyCard();
            _this.initWareHouseCard();
            _this.onResize();
            Laya.stage.on(Laya.Event.RESIZE, _this, _this.onResize);
            CardPackageManager.instance.testInitCards(function () {
            });
            Dispatcher.on("userBalance", _this, _this.userBalance);
            return _this;
        }
        SceneMenu.prototype.userBalance = function (changeCount, callNet) {
            if (callNet === void 0) { callNet = true; }
            var balance = parseInt(localStorage.getItem("balance"));
            balance += changeCount;
            localStorage.setItem("balance", balance + "");
            this._label.text = Utils.toNumberUnit(balance);
            if (callNet) {
                Ajax.callNet(GameConfig.RPC_URL, { "jsonrpc": "2.0", "method": Urls.eth_getBalance, "params": [localStorage.getItem("uuid"), "latest"], "id": 67 }, "POST", null, function (data) {
                    var balance = parseInt(parseInt(JSON.parse(data).result, 16).toString(10));
                    localStorage.setItem('balance', balance + "");
                    this._label.text = Utils.toNumberUnit(balance);
                }.bind(this));
            }
        };
        Object.defineProperty(SceneMenu, "instance", {
            get: function () {
                if (!this._instance)
                    this._instance = new menu.SceneMenu();
                return this._instance;
            },
            enumerable: true,
            configurable: true
        });
        SceneMenu.prototype.onResize = function (e) {
            if (e === void 0) { e = null; }
            var scale = Laya.stage.width / this._preWidth;
            this._circleDis = this._circleDis + (Laya.stage.width - this._preWidth >> 2);
            this.width = Laya.stage.width;
            this.height = Laya.stage.height;
            this._btnWarehouse.on(Laya.Event.CLICK, this, this.onTouch);
            var whiteSpace = (Laya.stage.width - UITools.MAX_BG_WIDTH) >> 1;
            whiteSpace = whiteSpace <= 0 ? 0 : whiteSpace;
            this._btnWarehouse.x = (Laya.stage.width) - this.circleToRight - whiteSpace;
            this._btnCardPackage.on(Laya.Event.CLICK, this, this.onTouch);
            this._btnCardPackage.centerX = this._circleDis;
            this._btnShowcard.on(Laya.Event.CLICK, this, this.onTouch);
            this._btnBankExchange.on(Laya.Event.CLICK, this, this.onTouch);
            this._btnBankExchange.centerX = -this._circleDis;
            if (scale < 1) {
                // this._btnCardPackage.size(scale * this._btnCardPackage.width, scale * this._btnCardPackage.height)
                // this._btnShowcard.size(scale * this._btnShowcard.width, scale * this._btnShowcard.height)
                // this._btnBankExchange.size(scale * this._btnBankExchange.width, scale * this._btnBankExchange.height)
                // this._btnWarehouse.size(scale * this._btnWarehouse.width, scale * this._btnWarehouse.height)
            }
            //avator
            this.box.x = 15 + whiteSpace;
            this._balanceBox.x = Laya.stage.width - this._balanceImg.width - 16 - whiteSpace;
            this._preWidth = Laya.stage.width;
            //resize的时候可以刷新view，不用像上面这么麻烦，但是刷新比较耗性能
            // window.location.reload();
        };
        SceneMenu.prototype.onTouch = function (e) {
            switch (e.currentTarget) {
                case this._btnWarehouse:
                    Warehouse.instance.show(this);
                    break;
                case this._btnCardPackage:
                    MyCard.instance.show(this);
                    break;
                case this._btnShowcard:
                    ShowCard.instance.show(this);
                    break;
                case this._btnBankExchange:
                    Exchange.instance.show(this);
                    break;
            }
        };
        SceneMenu.prototype.initOpenCard = function () {
            this._btnShowcard = new menu.MenuCard(menu.SceneMenu._skinOpenCard);
            this._btnShowcard.y = this._yPos;
            this._btnShowcard.centerX = 0;
            this.addChild(this._btnShowcard);
        };
        SceneMenu.prototype.initExchangeCard = function () {
            this._btnBankExchange = new menu.MenuCard(menu.SceneMenu._skinExchange);
            this._btnBankExchange.y = this._yPos;
            this._btnBankExchange.centerX = -this._circleDis;
            this.addChild(this._btnBankExchange);
        };
        SceneMenu.prototype.initMyCard = function () {
            this._btnCardPackage = new menu.MenuCard(menu.SceneMenu._skinMyCard);
            this._btnCardPackage.y = this._yPos;
            this._btnCardPackage.centerX = this._circleDis;
            this.addChild(this._btnCardPackage);
        };
        SceneMenu.prototype.initWareHouseCard = function () {
            this._btnWarehouse = new menu.MenuCard("menu/menu_wareHouse.png");
            var whiteSpace = (Laya.stage.width - UITools.MAX_BG_WIDTH) >> 1;
            whiteSpace = whiteSpace <= 0 ? 0 : whiteSpace;
            this._btnWarehouse.x = (Laya.stage.width) - this.circleToRight - whiteSpace;
            this._btnWarehouse.y = Laya.stage.height - this.circleToBottom;
            this.addChild(this._btnWarehouse);
        };
        SceneMenu.prototype.initAvator = function () {
            this.box = new Laya.Box();
            this.box.pos(15, 15);
            this.addChild(this.box);
            var image = new Laya.Image("menu/menu_avator.png");
            this.box.addChild(image);
            var label = new Laya.Label(localStorage.getItem('uuid'));
            label.fontSize = 20;
            label.color = "#ffffff";
            label.pos(103, 20);
            this.box.addChild(label);
        };
        SceneMenu.prototype.initBalance = function () {
            this._btnWarehouse = new menu.MenuCard("menu/menu_wareHouse.png");
            var whiteSpace = (Laya.stage.width - UITools.MAX_BG_WIDTH) >> 1;
            this._balanceImg = new Laya.Image("menu/menu_icon_balance.png");
            this._balanceBox = new Laya.Box();
            this._balanceBox.pos(Laya.stage.width - this._balanceImg.width - 16 - whiteSpace, 40);
            this._balanceBox.size(this._balanceImg.width, this._balanceImg.height);
            this._balanceBox.addChild(this._balanceImg);
            this.addChild(this._balanceBox);
            this._label = new Laya.Label(Utils.toNumberUnit(parseInt(localStorage.getItem('balance'))));
            this._label.fontSize = 18;
            this._label.color = "#ffffff";
            this._label.centerY = this._label.centerX = 0;
            this._balanceBox.addChild(this._label);
        };
        SceneMenu._skinOpenCard = "menu/menu_openCard.png";
        SceneMenu._skinMyCard = "menu/menu_myCard.png";
        SceneMenu._skinExchange = "menu/menu_exchange.png";
        SceneMenu.bgMenu = "menu/img_bg.jpg";
        SceneMenu.BG = "menu/bg.jpg";
        SceneMenu.BG2 = "menu/bg_2.jpg";
        SceneMenu.cards_bottom = "menu/cards_bottom.png";
        return SceneMenu;
    }(Laya.View));
    menu.SceneMenu = SceneMenu;
})(menu || (menu = {}));
//# sourceMappingURL=SceneMenu.js.map